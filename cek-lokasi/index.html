<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Data Lokasi Realtime</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">

<h1 class="text-2xl font-bold mb-4">Data Lokasi Realtime</h1>

<div class="relative overflow-x-auto shadow-md sm:rounded-lg">
  <table class="w-full text-sm text-left text-gray-500 ">
    <thead class="text-xs text-gray-700 uppercase bg-gray-50 ">
      <tr>
        <th scope="col" class="px-6 py-3">Timestamp</th>
        <th scope="col" class="px-6 py-3">Longitude</th>
        <th scope="col" class="px-6 py-3">Latitude</th>
        <th scope="col" class="px-6 py-3">Aksi</th>
      </tr>
    </thead>
    <tbody id="tableBody">
      <!-- Data akan dimasukkan di sini -->
    </tbody>
  </table>
</div>

<script>
const apiUrl = "https://script.google.com/macros/s/AKfycbzi5dxCsfehVqPeM2ZAtDlh1JmBffrMpFprVx-mCv31wiTev8drSHS1OY3YDPqwXvKl/exec";

// Format angka dengan titik ribuan untuk tabel
function formatNumber(num) {
  if(!num) return "";
  let str = num.toString();
  let negative = false;
  if(str.startsWith("-")){
    negative = true;
    str = str.slice(1);
  }
  let result = "";
  while(str.length > 3){
    result = "." + str.slice(-3) + result;
    str = str.slice(0, -3);
  }
  result = str + result;
  return negative ? "-" + result : result;
}

// Parse koordinat untuk Maps (ubah menjadi desimal)
function parseCoord(coordStr) {
  if(!coordStr) return null;
  return parseFloat(coordStr.replace(/\./g, '')) / 1000000;
}

function loadData() {
  fetch(apiUrl)
    .then(res => res.json())
    .then(data => {
      const tbody = document.getElementById("tableBody");
      tbody.innerHTML = "";

      data.forEach((row, index) => {
        const timestamp = row["Timestamp"] || "";

        const longStr = row["Longtitude"] || "";
        const latStr = row["Latittude"] || "";

        const longDisplay = formatNumber(longStr.replace(/\D/g,'')); 
        const latDisplay = formatNumber(latStr.replace(/\D/g,''));

        const longCoord = parseCoord(longStr);
        const latCoord = parseCoord(latStr);

        let mapsEmbed = "";
        if(longCoord !== null && latCoord !== null){
          mapsEmbed = `<iframe 
                          width="200" height="150" 
                          class="mx-auto my-2 rounded"
                          src="https://maps.google.com/maps?q=${latCoord},${longCoord}&z=15&output=embed" 
                          loading="lazy">
                       </iframe>`;
        }

        // gunakan kelas odd/even seperti tema
        const rowClass = index % 2 === 0 ? "odd:bg-white" : "even:bg-gray-50";
        const borderClass = "border-b border-gray-200";

        tbody.innerHTML += `
          <tr class="${rowClass} ${borderClass}">
            <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">${timestamp}</th>
            <td class="px-6 py-4">${longDisplay}</td>
            <td class="px-6 py-4">${latDisplay}</td>
            <td class="px-6 py-4">${mapsEmbed}</td>
          </tr>
        `;
      });
    })
    .catch(err => console.error(err));
}

loadData();
setInterval(loadData, 5000);
</script>

</body>
</html>
