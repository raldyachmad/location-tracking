<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>Tampilkan Lokasi Saya</title>
  </head>
  <body>
    <h2>Lokasi Saya</h2>
    <p id="status">Mendeteksi lokasi...</p>
    <p id="koordinat"></p>
    <div id="map" style="margin-top: 20px"></div>

    <script>
      const scriptURL =
        "https://script.google.com/macros/s/AKfycbzi5dxCsfehVqPeM2ZAtDlh1JmBffrMpFprVx-mCv31wiTev8drSHS1OY3YDPqwXvKl/exec";

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          function (position) {
            const latitude = position.coords.latitude.toFixed(6);
            const longitude = position.coords.longitude.toFixed(6);

            // buat URL custom yang nanti disimpan di spreadsheet
            const mapsUrl = `http://127.0.0.1:5500/location.html?lat=${latitude}&lng=${longitude}`;
            console.log("Kirim ke sheet:", { longitude, latitude, mapsUrl });

            fetch(scriptURL, {
              method: "POST",
              body: JSON.stringify({ longitude, latitude, mapsUrl }),
            });

            // tampilkan koordinat di halaman
            document.getElementById(
              "koordinat"
            ).innerText = `Latitude: ${latitude}, Longitude: ${longitude}`;

            // tampilkan peta embed
            const embedUrl = `https://www.google.com/maps?q=${latitude},${longitude}&hl=id&z=15&output=embed`;
            document.getElementById("map").innerHTML = `
          <iframe src="${embedUrl}" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
        `;

            document.getElementById("status").innerText = "Lokasi ditemukan âœ…";
          },
          function (error) {
            document.getElementById("status").innerText =
              "Gagal mendapatkan lokasi: " + error.message;
          }
        );
      } else {
        document.getElementById("status").innerText =
          "Browser tidak mendukung geolocation.";
      }
    </script>
  </body>
</html>
